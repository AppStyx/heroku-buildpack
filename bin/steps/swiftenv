# Fetch swiftenv
# unset GIT_DIR
# git submodule update --init --recursive >/dev/null

# Activate swiftenv
# export SWIFTENV_ROOT="$CACHE_DIR/swiftenv"
# export PATH="$ROOT_DIR/swiftenv/bin:$PATH"
# eval "$(swiftenv init -)"

# if ! [ -f "$BUILD_DIR/.swift-version" ] && [ -z "$SWIFT_VERSION" ]; then
#   export SWIFT_VERSION="$DEFAULT_SWIFT_VERSION"
# fi

# echo "installing ubuntu"
# curl -sL https://swift.vapor.sh/ubuntu | bash
# echo "done installing ubuntu"

echo "Swift 3 Quick Installer";

# Determine OS
UNAME=`uname`;
if [[ $UNAME == "Linux" ]];
then
    UBUNTU_RELEASE=`lsb_release -a 2>/dev/null`;
    if [[ $UBUNTU_RELEASE == *"14.04"* ]];
    then
        OS="ubuntu1404";
        TC="swift-3.0-RELEASE-ubuntu14.04"
    else
        OS="ubuntu1510";
        TC="swift-3.0-RELEASE-ubuntu15.10"
    fi
else
    echo "❌  Unsupported Operating System: $UNAME";
    exit 1;
fi

echo "🖥  Operating System: $OS";

echo "⬇️  Downloading"
wget https://swift.org/builds/swift-3.0-release/$OS/swift-3.0-RELEASE/$TC.tar.gz

echo "🔧  Untarring"
tar zxf $TC.tar.gz
rm -rf $TC.tar.gz

echo "🚀  Installing";
echo "🔒  Sudo required";
# mv $TC /swift-3.0

echo "export PATH=/${TC}/usr/bin:\"\${PATH}\"" >> ~/.bashrc
source ~/.bashrc

echo "✅  Done";
